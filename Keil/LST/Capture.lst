C51 COMPILER V9.60.0.0   CAPTURE                                                           08/23/2022 23:06:16 PAGE 1   


C51 COMPILER V9.60.0.0, COMPILATION OF MODULE CAPTURE
OBJECT MODULE PLACED IN .\Output\Capture.obj
COMPILER INVOKED BY: C:\Keil_v5_8051\C51\BIN\C51.EXE ..\Capture.c OPTIMIZE(8,SPEED) BROWSE INCDIR(..\..\..\..\Library\De
                    -vice\Include;..\..\..\..\Library\StdDriver\inc;..\..\Timer2_AutoReload_Capture) DEFINE(FOSC_160000) DEBUG OBJECTEXTEND P
                    -RINT(.\LST\Capture.lst) TABS(2) OBJECT(.\Output\Capture.obj)

line level    source

   1          /*--------------------------------------------------------------------------------------------------------
             --*/
   2          /*                                                                                                        
             - */
   3          /* Copyright(c) 2020 nuvoton Technology Corp. All rights reserved.                                        
             - */
   4          /*                                                                                                        
             - */
   5          /*--------------------------------------------------------------------------------------------------------
             --*/
   6          
   7          /*********************************************************************************************************
             -**/
   8          /* Website: http://www.nuvoton.com                                                                        
             - */
   9          /*  E-Mail : MicroC-8bit@nuvoton.com                                                                      
             - */
  10          /*  Date   : Jan/21/2020                                                                                  
             - */
  11          /*********************************************************************************************************
             -**/
  12          
  13          /*********************************************************************************************************
             -***/
  14          /*  File Function: MS51 Timer 2 capture function demo                                                     
             -  */
  15          //********************************************************************************************************
             -***/
  16          #include "IR.h"
  17          #include "millis.h"
  18          #include "board.h"
  19          
  20          static void find_lock_handle();
  21          static void open_lock_handle();
  22          static void close_lock_handle();
  23          
  24          uint32_t u32Cmd, current_time;
  25          uint8_t count_open = 0;
  26          /*********************************************   *********************************************************
             -******/
  27          /*    Main function                                                                                       
             -  */
  28          /*********************************************************************************************************
             -***/
  29          void main(void)
  30          {
  31   1        millis_init();
  32   1        IR_Init();
  33   1        board_io_init();
  34   1        board_pwm_init();
  35   1      
  36   1        while (1)
  37   1        {
C51 COMPILER V9.60.0.0   CAPTURE                                                           08/23/2022 23:06:16 PAGE 2   

  38   2          LED_OUT_PIN = 0;
  39   2          current_time = millis();
  40   2          while (millis() - current_time < 20000)
  41   2          {
  42   3            if (IR_Check(&u32Cmd, 1))
  43   3            {
  44   4              switch (u32Cmd)
  45   4              {
  46   5              case FIND_LOCK:
  47   5                  LED_OUT_PIN = 1;
  48   5                current_time = millis();
  49   5                find_lock_handle();
  50   5                break;
  51   5              case OPEN_LOCK:
  52   5                count_open++;
  53   5                if(count_open >= 90)
  54   5                  open_lock_handle();
  55   5                break;
  56   5              case CLOSE_LOCK:
  57   5                close_lock_handle();
  58   5                break;
  59   5              }
  60   4            }
  61   3          }
  62   2      
  63   2        }
  64   1      }
  65          
  66          static void find_lock_handle()
  67          {
  68   1        int i;
  69   1        for (i = 0; i < 3; i++)
  70   1        {
  71   2          PWMRUN = 1;
  72   2          XINHAN_OUT_PIN = 1;
  73   2          delay_ms(1000);
  74   2          XINHAN_OUT_PIN = 0;
  75   2          PWMRUN = 0;
  76   2          delay_ms(500);
  77   2        }
  78   1      }
  79          
  80          static void open_lock_handle()
  81          {
  82   1        PWMRUN = 1;
  83   1        XINHAN_OUT_PIN = 1;
  84   1        delay_ms(1000);
  85   1        XINHAN_OUT_PIN = 0;
  86   1        delay_ms(2000);
  87   1        PWMRUN = 0;
  88   1        LOCK_OUT_PIN = 1;
  89   1        count_open = 0;
  90   1      }
  91          
  92          static void close_lock_handle()
  93          {
  94   1        int i;
  95   1        for(i = 0; i < 2; i++)
  96   1        {
  97   2          PWMRUN = 1;
  98   2          XINHAN_OUT_PIN = 1;
  99   2          delay_ms(1000);
C51 COMPILER V9.60.0.0   CAPTURE                                                           08/23/2022 23:06:16 PAGE 3   

 100   2          XINHAN_OUT_PIN = 0;
 101   2          PWMRUN = 0;
 102   2          delay_ms(500);
 103   2        }
 104   1        LOCK_OUT_PIN = 0;
 105   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    294    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      9       4
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
